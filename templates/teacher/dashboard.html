{% extends "teacher/base_teacher.html" %}

{% block title %}Teacher Dashboard - SPAS{% endblock %}

{% block header_title %}Dashboard{% endblock %}
{% block header_subtitle %}Overview of your subjects and students{% endblock %}

{% block extra_css %}
<style>
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        border: 1px solid #e9ecef;
        display: flex;
        align-items: center;
        gap: 15px;
        transition: all 0.3s;
    }
    
    .stat-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 25px rgba(111, 66, 193, 0.1);
        border-color: #6f42c1;
    }
    
    .stat-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: #f3e9ff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        color: #6f42c1;
    }
    
    .stat-content h3 {
        font-size: 1.8rem;
        font-weight: 700;
        color: #2c3e50;
        margin: 0;
    }
    
    .stat-content p {
        color: #6c757d;
        margin: 5px 0 0;
    }
    
    .subject-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 15px;
        border: 1px solid #e9ecef;
        transition: all 0.3s;
    }
    
    .subject-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 25px rgba(111, 66, 193, 0.1);
        border-color: #6f42c1;
    }
    
    .subject-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }
    
    .subject-name {
        font-size: 1.2rem;
        font-weight: 600;
        color: #6f42c1;
    }
    
    .subject-code {
        background: #f3e9ff;
        color: #6f42c1;
        padding: 3px 10px;
        border-radius: 15px;
        font-size: 0.85rem;
    }
    
    .btn-enter-marks {
        background: linear-gradient(135deg, #6f42c1, #9b59b6);
        color: white;
        border: none;
        padding: 8px 20px;
        border-radius: 8px;
        font-size: 0.9rem;
        transition: all 0.3s;
        text-decoration: none;
        display: inline-block;
    }
    
    .btn-enter-marks:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(111, 66, 193, 0.3);
        color: white;
    }
    
    .performance-table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .performance-table thead th {
        background: #f3e9ff;
        color: #6f42c1;
        padding: 15px;
        font-weight: 600;
    }
    
    .performance-table tbody td {
        padding: 12px 15px;
        border-bottom: 1px solid #e9ecef;
        text-align: center;
    }
    
    .performance-table tbody tr:hover {
        background: #f8f9fa;
    }
    
    .grade-badge {
        padding: 5px 12px;
        border-radius: 20px;
        font-weight: 600;
        display: inline-block;
    }
    
    .grade-aplus { background: #6f42c1; color: white; }
    .grade-a { background: #9b59b6; color: white; }
    .grade-b { background: #3498db; color: white; }
    .grade-c { background: #f1c40f; color: #2c3e50; }
    .grade-d { background: #e74c3c; color: white; }
    
    .risk-badge {
        padding: 5px 12px;
        border-radius: 20px;
        font-weight: 600;
        display: inline-block;
    }
    
    .risk-critical { background: #dc3545; color: white; }
    .risk-average { background: #ffc107; color: #2c3e50; }
    .risk-safe { background: #28a745; color: white; }
    .risk-best { background: #6f42c1; color: white; }
    
    .btn-edit {
        background: transparent;
        border: 2px solid #6f42c1;
        color: #6f42c1;
        padding: 5px 12px;
        border-radius: 6px;
        transition: all 0.3s;
        text-decoration: none;
        font-size: 0.9rem;
    }
    
    .btn-edit:hover {
        background: #6f42c1;
        color: white;
    }
</style>
{% endblock %}

{% block content %}
<!-- Statistics Cards -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-users"></i>
        </div>
        <div class="stat-content">
            <h3>{{ total_students }}</h3>
            <p>Total Students</p>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-book"></i>
        </div>
        <div class="stat-content">
            <h3>{{ subjects|length }}</h3>
            <p>Assigned Subjects</p>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="stat-content">
            <h3>{{ critical_count }}</h3>
            <p>Critical Risk</p>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-star"></i>
        </div>
        <div class="stat-content">
            <h3>{{ best_count }}</h3>
            <p>Best Performers</p>
        </div>
    </div>
</div>

<!-- Assigned Subjects -->
<!-- Assigned Subjects -->
<h5 class="mb-3"><i class="fas fa-book me-2 text-purple"></i>Your Subjects</h5>

<div class="row mb-4">
    {% for subject in subjects %}
    <div class="col-md-4">
        <div class="subject-card">
            <div class="subject-header">
                <span class="subject-name">{{ subject.name }}</span>
                <span class="subject-code">{{ subject.code }}</span>
            </div>
            <p class="text-muted mb-2">Semester {{ subject.semester }}</p>
            <div class="d-flex gap-2">
                <a href="{{ url_for('teacher.marks_list', subject_id=subject.id) }}" class="btn-enter-marks" style="background: #6f42c1;">
                    <i class="fas fa-list me-2"></i>Students
                </a>
                <a href="{{ url_for('teacher.attendance_entry', subject_id=subject.id) }}" class="btn-enter-marks" style="background: #28a745;">
                    <i class="fas fa-calendar-check me-2"></i>Attendance
                </a>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
</div>

<!-- Performance Table -->
<h5 class="mb-3"><i class="fas fa-chart-line me-2 text-purple"></i>Student Performance</h5>

<div class="table-responsive">
    <table class="performance-table datatable">
        <thead>
            <tr>
                <th>Student ID</th>
                <th>Name</th>
                <th>Reg No</th>
                <th>Attendance %</th>
                <th>Final/20</th>
                <th>Marks %</th>
                <th>Grade</th>
                <th>Risk</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for perf in performances %}
            <tr>
                <td><span class="badge bg-purple-soft text-purple">{{ perf.student.student_id }}</span></td>
                <td>{{ perf.student.name }}</td>
                <td>{{ perf.student.registration_number }}</td>
                <td>
                    {{ perf.attendance_percentage }}%
                    {% if perf.attendance_percentage < 70 %}
                        <i class="fas fa-exclamation-circle text-danger ms-1"></i>
                    {% endif %}
                </td>
                <td><strong>{{ perf.final_marks }}</strong></td>
                <td>{{ perf.percentage }}%</td>
                <td>
                    <span class="grade-badge 
                        {% if perf.grade == 'A+' %}grade-aplus
                        {% elif perf.grade == 'A' %}grade-a
                        {% elif perf.grade == 'B' %}grade-b
                        {% elif perf.grade == 'C' %}grade-c
                        {% else %}grade-d{% endif %}">
                        {{ perf.grade }}
                    </span>
                </td>
                <td>
                    <span class="risk-badge 
                        {% if perf.risk_status == 'Critical' %}risk-critical
                        {% elif perf.risk_status == 'Average' %}risk-average
                        {% elif perf.risk_status == 'Safe' %}risk-safe
                        {% else %}risk-best{% endif %}">
                        {{ perf.risk_status }}
                    </span>
                </td>
                <td>
    <a href="{{ url_for('teacher.enter_marks', subject_id=perf.subject_id) }}?student_id={{ perf.student.id }}" class="btn-edit">
        <i class="fas fa-edit me-1"></i>Edit
    </a>
</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="9" class="text-center text-muted py-4">
                    <i class="fas fa-chart-line fa-3x mb-3"></i>
                    <p>No performance records found. Start by entering marks.</p>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}